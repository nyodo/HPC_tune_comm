# é¡¹ç›®æ¶æ„è¯´æ˜ï¼šå‰åç«¯ä¸æ•°æ®åº“è¿æ¥æœºåˆ¶

## ğŸ“‹ ç›®å½•
1. [æ•´ä½“æ¶æ„æ¦‚è§ˆ](#æ•´ä½“æ¶æ„æ¦‚è§ˆ)
2. [å‰ç«¯æ¶æ„](#å‰ç«¯æ¶æ„)
3. [åç«¯æ¶æ„](#åç«¯æ¶æ„)
4. [æ•°æ®åº“æ¶æ„](#æ•°æ®åº“æ¶æ„)
5. [æ•°æ®æµè½¬è¿‡ç¨‹](#æ•°æ®æµè½¬è¿‡ç¨‹)
6. [ç™»å½•è®¤è¯æµç¨‹](#ç™»å½•è®¤è¯æµç¨‹)
7. [API è¯·æ±‚æµç¨‹](#api-è¯·æ±‚æµç¨‹)

---

## æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æµè§ˆå™¨                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å‰ç«¯ (Vue 3 + Vite)                                  â”‚  â”‚
â”‚  â”‚  - ç«¯å£: 8080                                         â”‚  â”‚
â”‚  â”‚  - åœ°å€: http://127.0.0.1:8080                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP è¯·æ±‚ (é€šè¿‡ä»£ç†)
                          â”‚ /api/* â†’ http://127.0.0.1:8108/*
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯ (Flask)                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  - ç«¯å£: 8108                                          â”‚  â”‚
â”‚  â”‚  - åœ°å€: http://127.0.0.1:8108                        â”‚  â”‚
â”‚  â”‚  - æ¡†æ¶: Flask + Flask-SQLAlchemy                      â”‚  â”‚
â”‚  â”‚  - CORS: å·²å¯ç”¨ï¼ˆå…è®¸è·¨åŸŸï¼‰                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ SQLAlchemy ORM
                          â”‚ mysql://root:123456@127.0.0.1:3306/visualtool
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL æ•°æ®åº“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  - åœ°å€: 127.0.0.1:3306                               â”‚  â”‚
â”‚  â”‚  - æ•°æ®åº“å: visualtool                               â”‚  â”‚
â”‚  â”‚  - ç”¨æˆ·: root / å¯†ç : 123456                          â”‚  â”‚
â”‚  â”‚  - è¡¨: user, dcu, file                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‰ç«¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Vue 3
- **æ„å»ºå·¥å…·**: Vite
- **HTTP å®¢æˆ·ç«¯**: Axios
- **UI ç»„ä»¶åº“**: Element Plus
- **è·¯ç”±**: Vue Router

### å…³é”®æ–‡ä»¶è¯´æ˜

#### 1. `vis/vite.config.js` - å¼€å‘æœåŠ¡å™¨é…ç½®
```javascript
server: {
  host: "127.0.0.1",
  port: 8080,
  proxy: {
    "/api": {
      target: "http://127.0.0.1:8108",  // åç«¯åœ°å€
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, ""),  // å»æ‰ /api å‰ç¼€
    },
  },
}
```

**ä½œç”¨**ï¼š
- å‰ç«¯è¿è¡Œåœ¨ `http://127.0.0.1:8080`
- æ‰€æœ‰ä»¥ `/api` å¼€å¤´çš„è¯·æ±‚ä¼šè¢«ä»£ç†åˆ°åç«¯ `http://127.0.0.1:8108`
- ä¾‹å¦‚ï¼š`/api/login/` â†’ `http://127.0.0.1:8108/login/`

#### 2. `vis/src/utils/request.js` - HTTP è¯·æ±‚å°è£…

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

1. **åˆ›å»º Axios å®ä¾‹**
   ```javascript
   const request = axios.create({
     baseURL: hostURL,  // ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œé€šå¸¸æ˜¯ /api
     timeout: 15000,
   })
   ```

2. **è¯·æ±‚æ‹¦æˆªå™¨** - è‡ªåŠ¨æ·»åŠ  Token
   ```javascript
   request.interceptors.request.use(config => {
     let token = localStorage.getItem("token");
     if (token) {
       config.headers['Ac-Token'] = token  // æ·»åŠ åˆ°è¯·æ±‚å¤´
     }
     return config
   })
   ```

3. **å“åº”æ‹¦æˆªå™¨** - ç»Ÿä¸€é”™è¯¯å¤„ç†
   ```javascript
   request.interceptors.response.use(res => {
     if (res.data.code === 401) {
       Router.push("/login")  // Token è¿‡æœŸï¼Œè·³è½¬ç™»å½•
       localStorage.clear()
     }
     return res
   })
   ```

#### 3. `vis/src/views/login/login.vue` - ç™»å½•é¡µé¢

**ç™»å½•æµç¨‹**ï¼š
```javascript
// 1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åã€å¯†ç ã€é€‰æ‹©èº«ä»½
this.$request.post("/login/", {
  username: this.userForm.accountNumber,
  password: this.userForm.userPassword,
  value: this.userForm.value  // '0'=ç”¨æˆ·, '1'=ç®¡ç†å‘˜
})

// 2. æˆåŠŸåä¿å­˜ Token å’Œç”¨æˆ·ä¿¡æ¯
localStorage.setItem("token", res.data.data.token)
localStorage.setItem("username", res.data.data.username)
localStorage.setItem("userId", res.data.data.user_id)
localStorage.setItem("isAdmin", res.data.data.isAdmin)

// 3. è·³è½¬åˆ°ä¸»é¡µé¢
this.$router.push('/main')
```

#### 4. `vis/src/router/index.js` - è·¯ç”±å®ˆå«

**è·¯ç”±ä¿æŠ¤**ï¼š
```javascript
router.beforeEach((to, from, next) => {
  let token = localStorage.getItem("token");
  if (token) {
    next();  // æœ‰ Tokenï¼Œå…è®¸è®¿é—®
  } else {
    if (to.path === "/login" || to.path === "/register") {
      next();  // ç™»å½•/æ³¨å†Œé¡µé¢å…è®¸è®¿é—®
    } else {
      next({ path: "/login" });  // å…¶ä»–é¡µé¢é‡å®šå‘åˆ°ç™»å½•
    }
  }
})
```

---

## åç«¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Flask
- **ORM**: Flask-SQLAlchemy
- **æ•°æ®åº“è¿ç§»**: Flask-Migrate
- **è·¨åŸŸ**: Flask-CORS
- **è®¤è¯**: JWT (PyJWT)

### å…³é”®æ–‡ä»¶è¯´æ˜

#### 1. `visualtool-backend/app.py` - ä¸»åº”ç”¨æ–‡ä»¶

**åˆå§‹åŒ–æµç¨‹**ï¼š

```python
# 1. åˆ›å»º Flask åº”ç”¨
app = Flask(__name__)

# 2. é…ç½® CORSï¼ˆå…è®¸è·¨åŸŸè¯·æ±‚ï¼‰
CORS(app, resources={r"/*": {"origins": "*"}})

# 3. é…ç½®æ•°æ®åº“è¿æ¥
class Config(object):
    SQLALCHEMY_DATABASE_URI = "mysql://root:123456@127.0.0.1:3306/visualtool"
    SQLALCHEMY_TRACK_MODIFICATIONS = True

app.config.from_object(Config)

# 4. åˆå§‹åŒ–æ•°æ®åº“
db.init_app(app)
migrate = Migrate(app, db)

# 5. æ³¨å†Œè“å›¾ï¼ˆè·¯ç”±æ¨¡å—ï¼‰
app.register_blueprint(user_bp, url_prefix='/users')
app.register_blueprint(dcu_bp, url_prefix='/dcus')
app.register_blueprint(file_bp, url_prefix='/files')
```

**å¯åŠ¨æœåŠ¡å™¨**ï¼š
```python
if __name__ == "__main__":
    app.run(host='127.0.0.1', port=8108, debug=True)
```

#### 2. `visualtool-backend/models.py` - æ•°æ®åº“æ¨¡å‹

**æ•°æ®è¡¨å®šä¹‰**ï¼š

```python
# User è¡¨ - ç”¨æˆ·ä¿¡æ¯
class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(255), nullable=False)
    password = db.Column(db.String(255), nullable=False)
    tel = db.Column(db.String(255))
    name = db.Column(db.String(255))
    is_admin = db.Column(db.Boolean, default=False)
    created_time = db.Column(db.DateTime, default=datetime.now)

# Dcu è¡¨ - DCU åˆ†æè®°å½•
class Dcu(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    file_id = db.Column(db.Integer)
    text = db.Column(db.Text, nullable=False)
    analysis = db.Column(db.Text, nullable=False)
    improve = db.Column(db.Text, nullable=False)
    created_time = db.Column(db.DateTime, default=datetime.now)
    user = db.relationship('User', backref=db.backref('dcus', lazy=True))

# File è¡¨ - æ–‡ä»¶ä¿¡æ¯
class File(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    filename = db.Column(db.String(255), nullable=False)
    server_filename = db.Column(db.String(255), nullable=False)
    created_time = db.Column(db.DateTime, default=datetime.now)
```

#### 3. `visualtool-backend/app.py` - ç™»å½•æ¥å£

**ç™»å½•å¤„ç†æµç¨‹**ï¼š

```python
@app.route("/login/", methods=['POST'])
def login():
    # 1. è·å–å‰ç«¯ä¼ æ¥çš„ç”¨æˆ·åã€å¯†ç ã€èº«ä»½
    username = request.json["username"]
    password = request.json["password"]
    value = request.json["value"]  # '0'=ç”¨æˆ·, '1'=ç®¡ç†å‘˜
    
    # 2. æŸ¥è¯¢æ•°æ®åº“éªŒè¯ç”¨æˆ·
    user = User.query.filter_by(username=username, password=password).first()
    
    # 3. éªŒè¯å¤±è´¥
    if not user:
        return jsonify({
            "meta": {"status": 500, "message": "ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯"}
        })
    
    # 4. éªŒè¯æˆåŠŸï¼Œç”Ÿæˆ JWT Token
    token_data = {
        "exp": int((datetime.now() + timedelta(days=1)).timestamp()),  # 1å¤©è¿‡æœŸ
        "iat": int(datetime.now().timestamp()),
        "id": user.id,
        "username": user.username,
    }
    token = jwt.encode(token_data, SECRET_KEY, algorithm="HS256")
    
    # 5. è¿”å› Token å’Œç”¨æˆ·ä¿¡æ¯
    return jsonify({
        "data": {
            "token": token,
            "username": user.username,
            "user_id": user.id,
            "isAdmin": 1 if (value == '1' and user.is_admin) else 0
        },
        "meta": {"status": 200, "message": "ç™»å½•æˆåŠŸ"}
    })
```

#### 4. `visualtool-backend/api/user.py` - ç”¨æˆ·ç®¡ç† API

**CRUD æ“ä½œç¤ºä¾‹**ï¼š

```python
# è·å–æ‰€æœ‰ç”¨æˆ·ï¼ˆå¸¦åˆ†é¡µï¼‰
@user_bp.route('/', methods=['GET'])
def get_all_user():
    page = request.args.get('pageNum', default=1, type=int)
    per_page = request.args.get('pageSize', default=10, type=int)
    user_list = User.query.all()
    # ... åˆ†é¡µå¤„ç†
    return jsonify({'code': 200, 'data': result})

# åˆ›å»ºç”¨æˆ·
@user_bp.route('/', methods=['POST'])
def add_user():
    data = request.json
    user = User(
        username=data['username'],
        password=data['password'],
        # ...
    )
    db.session.add(user)
    db.session.commit()
    return jsonify({'code': 200, 'data': 'å¢åŠ æˆåŠŸ'})
```

---

## æ•°æ®åº“æ¶æ„

### è¿æ¥é…ç½®

**ä½ç½®**: `visualtool-backend/app.py`

```python
SQLALCHEMY_DATABASE_URI = "mysql://root:123456@127.0.0.1:3306/visualtool"
```

**æ ¼å¼è¯´æ˜**ï¼š
- `mysql://` - æ•°æ®åº“ç±»å‹
- `root` - ç”¨æˆ·å
- `123456` - å¯†ç 
- `127.0.0.1:3306` - ä¸»æœºå’Œç«¯å£
- `visualtool` - æ•°æ®åº“å

### æ•°æ®è¡¨å…³ç³»

```
User (ç”¨æˆ·è¡¨)
  â”œâ”€ id (ä¸»é”®)
  â”œâ”€ username
  â”œâ”€ password
  â”œâ”€ is_admin
  â””â”€ created_time
      â”‚
      â””â”€ ä¸€å¯¹å¤šå…³ç³»
          â”‚
          â””â”€ Dcu (åˆ†æè®°å½•è¡¨)
              â”œâ”€ id (ä¸»é”®)
              â”œâ”€ user_id (å¤–é”® â†’ User.id)
              â”œâ”€ file_id
              â”œâ”€ text
              â”œâ”€ analysis
              â”œâ”€ improve
              â””â”€ created_time

File (æ–‡ä»¶è¡¨)
  â”œâ”€ id (ä¸»é”®)
  â”œâ”€ filename
  â”œâ”€ server_filename
  â””â”€ created_time
```

---

## æ•°æ®æµè½¬è¿‡ç¨‹

### å®Œæ•´è¯·æ±‚æµç¨‹ç¤ºä¾‹ï¼šç”¨æˆ·ç™»å½•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”¨æˆ·æ“ä½œ  â”‚  ç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥ç”¨æˆ·åã€å¯†ç ï¼Œç‚¹å‡»ç™»å½•
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. å‰ç«¯å‘é€è¯·æ±‚                                          â”‚
â”‚  vis/src/views/login/login.vue                           â”‚
â”‚                                                          â”‚
â”‚  this.$request.post("/login/", {                        â”‚
â”‚    username: "admin",                                    â”‚
â”‚    password: "admin",                                    â”‚
â”‚    value: "1"                                            â”‚
â”‚  })                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. è¯·æ±‚æ‹¦æˆªå™¨å¤„ç†                                        â”‚
â”‚  vis/src/utils/request.js                                â”‚
â”‚                                                          â”‚
â”‚  - æ£€æŸ¥ localStorage ä¸­çš„ token                         â”‚
â”‚  - å¦‚æœæœ‰ tokenï¼Œæ·»åŠ åˆ°è¯·æ±‚å¤´: Ac-Token                  â”‚
â”‚  - å‘é€è¯·æ±‚åˆ°: /api/login/                              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Vite ä»£ç†è½¬å‘                                        â”‚
â”‚  vis/vite.config.js                                      â”‚
â”‚                                                          â”‚
â”‚  /api/login/ â†’ http://127.0.0.1:8108/login/            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Flask æ¥æ”¶è¯·æ±‚                                        â”‚
â”‚  visualtool-backend/app.py                               â”‚
â”‚                                                          â”‚
â”‚  @app.route("/login/", methods=['POST'])                â”‚
â”‚  def login():                                            â”‚
â”‚      username = request.json["username"]                 â”‚
â”‚      password = request.json["password"]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. æ•°æ®åº“æŸ¥è¯¢                                            â”‚
â”‚  visualtool-backend/app.py                              â”‚
â”‚                                                          â”‚
â”‚  user = User.query.filter_by(                           â”‚
â”‚      username=username,                                  â”‚
â”‚      password=password                                   â”‚
â”‚  ).first()                                               â”‚
â”‚                                                          â”‚
â”‚  SQL æ‰§è¡Œ:                                               â”‚
â”‚  SELECT * FROM user                                      â”‚
â”‚  WHERE username='admin' AND password='admin'            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. ç”Ÿæˆ Token                                            â”‚
â”‚  visualtool-backend/app.py                              â”‚
â”‚                                                          â”‚
â”‚  token = jwt.encode({                                    â”‚
â”‚      "id": user.id,                                      â”‚
â”‚      "username": user.username,                           â”‚
â”‚      "exp": ...                                          â”‚
â”‚  }, SECRET_KEY)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. è¿”å›å“åº”                                              â”‚
â”‚  visualtool-backend/app.py                              â”‚
â”‚                                                          â”‚
â”‚  return jsonify({                                        â”‚
â”‚      "data": {                                           â”‚
â”‚          "token": "...",                                 â”‚
â”‚          "username": "admin",                            â”‚
â”‚          "user_id": 1,                                   â”‚
â”‚          "isAdmin": 1                                     â”‚
â”‚      },                                                  â”‚
â”‚      "meta": {"status": 200, "message": "ç™»å½•æˆåŠŸ"}      â”‚
â”‚  })                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9. å“åº”æ‹¦æˆªå™¨å¤„ç†                                        â”‚
â”‚  vis/src/utils/request.js                                â”‚
â”‚                                                          â”‚
â”‚  - æ£€æŸ¥å“åº”çŠ¶æ€ç                                         â”‚
â”‚  - å¦‚æœæ˜¯ 401ï¼Œæ¸…é™¤ token å¹¶è·³è½¬ç™»å½•                     â”‚
â”‚  - è¿”å›å“åº”æ•°æ®                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  10. å‰ç«¯å¤„ç†å“åº”                                         â”‚
â”‚  vis/src/views/login/login.vue                           â”‚
â”‚                                                          â”‚
â”‚  if (res.data.meta.status === 200) {                   â”‚
â”‚      localStorage.setItem("token", res.data.data.token) â”‚
â”‚      localStorage.setItem("username", ...)                â”‚
â”‚      this.$router.push('/main')                          â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç™»å½•è®¤è¯æµç¨‹

### JWT Token æœºåˆ¶

1. **ç™»å½•æ—¶ç”Ÿæˆ Token**
   ```python
   # åç«¯ç”Ÿæˆ
   token = jwt.encode({
       "id": user.id,
       "username": user.username,
       "exp": è¿‡æœŸæ—¶é—´
   }, SECRET_KEY)
   ```

2. **å‰ç«¯ä¿å­˜ Token**
   ```javascript
   localStorage.setItem("token", token)
   ```

3. **åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦ Token**
   ```javascript
   // è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ 
   config.headers['Ac-Token'] = token
   ```

4. **åç«¯éªŒè¯ Token**ï¼ˆå¯é€‰ï¼Œå½“å‰ä»£ç ä¸­æœªå®ç°ä¸­é—´ä»¶ï¼‰
   ```python
   def verify_token(token):
       payload = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
       return payload
   ```

### è·¯ç”±ä¿æŠ¤

- **å‰ç«¯è·¯ç”±å®ˆå«**: æ£€æŸ¥ `localStorage` ä¸­æ˜¯å¦æœ‰ `token`
- **æ—  Token**: é‡å®šå‘åˆ° `/login`
- **æœ‰ Token**: å…è®¸è®¿é—®

---

## API è¯·æ±‚æµç¨‹

### è¯·æ±‚è·¯å¾„è½¬æ¢

```
å‰ç«¯è¯·æ±‚: /api/login/
    â†“
Vite ä»£ç†: åŒ¹é… /api å‰ç¼€
    â†“
è·¯å¾„é‡å†™: å»æ‰ /api â†’ /login/
    â†“
è½¬å‘åˆ°åç«¯: http://127.0.0.1:8108/login/
    â†“
Flask è·¯ç”±: @app.route("/login/", methods=['POST'])
```

### è¯·æ±‚å¤´ç¤ºä¾‹

```http
POST /api/login/ HTTP/1.1
Host: 127.0.0.1:8080
Content-Type: application/json
Ac-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...  (å¦‚æœæœ‰)

{
  "username": "admin",
  "password": "admin",
  "value": "1"
}
```

### å“åº”æ ¼å¼

```json
{
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "username": "admin",
    "user_id": 1,
    "isAdmin": 1
  },
  "meta": {
    "status": 200,
    "message": "ç™»å½•æˆåŠŸ"
  }
}
```

---

## å…³é”®é…ç½®æ€»ç»“

### å‰ç«¯é…ç½®
- **å¼€å‘æœåŠ¡å™¨**: `http://127.0.0.1:8080`
- **API ä»£ç†**: `/api/*` â†’ `http://127.0.0.1:8108/*`
- **Token å­˜å‚¨**: `localStorage`

### åç«¯é…ç½®
- **æœåŠ¡å™¨åœ°å€**: `http://127.0.0.1:8108`
- **CORS**: å…è®¸æ‰€æœ‰æ¥æº (`*`)
- **æ•°æ®åº“**: MySQL `127.0.0.1:3306/visualtool`

### æ•°æ®åº“é…ç½®
- **ç±»å‹**: MySQL
- **åœ°å€**: `127.0.0.1:3306`
- **æ•°æ®åº“å**: `visualtool`
- **ç”¨æˆ·**: `root` / `123456`

---

## å¸¸è§é—®é¢˜

### 1. è·¨åŸŸé—®é¢˜
- **è§£å†³**: Flask-CORS å·²é…ç½®å…è®¸æ‰€æœ‰æ¥æº
- **é…ç½®ä½ç½®**: `app.py` ç¬¬ 32 è¡Œ

### 2. Token éªŒè¯
- **å½“å‰çŠ¶æ€**: ç™»å½•æ¥å£ç”Ÿæˆ Tokenï¼Œä½†å…¶ä»–æ¥å£æœªéªŒè¯
- **å»ºè®®**: æ·»åŠ ä¸­é—´ä»¶éªŒè¯ Tokenï¼ˆå¯é€‰ï¼‰

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
- **æ£€æŸ¥**: MySQL æœåŠ¡æ˜¯å¦è¿è¡Œ
- **æ£€æŸ¥**: æ•°æ®åº“ `visualtool` æ˜¯å¦å­˜åœ¨
- **æ£€æŸ¥**: ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®

### 4. ä»£ç†ä¸å·¥ä½œ
- **æ£€æŸ¥**: Vite å¼€å‘æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
- **æ£€æŸ¥**: `vite.config.js` ä¸­çš„ä»£ç†é…ç½®
- **æ£€æŸ¥**: åç«¯æœåŠ¡æ˜¯å¦åœ¨ 8108 ç«¯å£è¿è¡Œ

---

## æ€»ç»“

è¿™ä¸ªé¡¹ç›®é‡‡ç”¨äº†ç»å…¸çš„**å‰åç«¯åˆ†ç¦»æ¶æ„**ï¼š

1. **å‰ç«¯**: Vue 3 + Viteï¼Œé€šè¿‡ä»£ç†è®¿é—®åç«¯ API
2. **åç«¯**: Flask RESTful APIï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘
3. **æ•°æ®åº“**: MySQLï¼Œé€šè¿‡ SQLAlchemy ORM æ“ä½œ
4. **è®¤è¯**: JWT Tokenï¼Œå­˜å‚¨åœ¨æµè§ˆå™¨ localStorage

æ•´ä¸ªç³»ç»Ÿé€šè¿‡ HTTP è¯·æ±‚è¿›è¡Œé€šä¿¡ï¼Œæ•°æ®ä»¥ JSON æ ¼å¼ä¼ è¾“ï¼Œå®ç°äº†å‰åç«¯çš„è§£è€¦å’Œç‹¬ç«‹å¼€å‘ã€‚
