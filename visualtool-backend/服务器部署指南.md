# 服务器部署指南

## 服务器连接信息说明

你提供的这些信息是 **SSH（Secure Shell）连接信息**，用于远程连接到实验室的 GPU 服务器：

```
IP 地址：10.181.142.180
端口：1022
用户名：ls
密码：camel
```

### 这些信息的含义：

1. **IP 地址 (10.181.142.180)**：服务器的网络地址
2. **端口 (1022)**：SSH 服务的端口（默认是 22，这里使用的是 1022）
3. **用户名 (ls)**：登录服务器的用户名
4. **密码 (camel)**：登录密码

## 如何连接到服务器

### 方法 1：使用 Windows PowerShell（推荐）

```powershell
# 使用 SSH 连接到服务器
ssh -p 1022 ls@10.181.142.180

# 输入密码：camel
```

### 方法 2：使用 PuTTY（图形界面）

1. 下载并安装 PuTTY：https://www.putty.org/
2. 打开 PuTTY
3. 填写信息：
   - Host Name: `10.181.142.180`
   - Port: `1022`
   - Connection type: `SSH`
4. 点击 "Open"
5. 输入用户名：`ls`
6. 输入密码：`camel`

### 方法 3：使用 VS Code Remote SSH 扩展

1. 在 VS Code 中安装 "Remote - SSH" 扩展
2. 按 `F1` 或 `Ctrl+Shift+P`，输入 "Remote-SSH: Connect to Host"
3. 选择 "Add New SSH Host"
4. 输入：`ssh -p 1022 ls@10.181.142.180`
5. 保存后选择该主机连接
6. 输入密码：`camel`

## 在服务器上部署后端

### 步骤 1：连接到服务器

```bash
ssh -p 1022 ls@10.181.142.180
# 输入密码：camel
```

### 步骤 2：上传代码到服务器

**方法 A：使用 SCP（在本地 PowerShell 中执行）**

```powershell
# 从本地复制整个项目到服务器
scp -P 1022 -r visualtool-backend ls@10.181.142.180:~/

# 或者只复制特定文件
scp -P 1022 app.py ls@10.181.142.180:~/visualtool-backend/
```

**方法 B：使用 Git（在服务器上执行）**

```bash
# 在服务器上克隆仓库
cd ~
git clone <你的仓库地址>
cd HPC-Visual-Tuning-Modeling-Platform/visualtool-backend
```

**方法 C：使用 VS Code Remote SSH**

直接在 VS Code 中打开远程文件夹，编辑和保存会自动同步。

### 步骤 3：在服务器上设置环境

```bash
# 连接到服务器后
cd ~/visualtool-backend  # 或你的代码目录

# 激活 conda 环境（如果服务器上已有）
conda activate LS  # 注意：服务器上可能环境名是 LS

# 或者创建新环境
conda env create -f environment.yml
conda activate accessmemory  # 或 LS，取决于服务器配置

# 安装依赖（如果使用 pip）
pip install -r requirements.txt
```

### 步骤 4：配置数据库

在服务器上，可能需要修改 `app.py` 中的数据库配置：

```python
# 如果服务器上的 MySQL 配置不同，修改这里
SQLALCHEMY_DATABASE_URI = "mysql://root:你的密码@127.0.0.1:3306/visualtool"
```

### 步骤 5：启动后端服务

```bash
# 在服务器上运行
python app.py

# 或者使用 nohup 在后台运行
nohup python app.py > app.log 2>&1 &

# 或者使用 screen（推荐，方便管理）
screen -S backend
python app.py
# 按 Ctrl+A 然后 D 来分离会话
# 重新连接：screen -r backend
```

### 步骤 6：配置防火墙和端口

确保服务器防火墙允许访问后端端口（8108 或 8008）：

```bash
# 检查端口是否开放
netstat -tuln | grep 8108

# 如果需要开放端口（根据服务器系统不同）
# Ubuntu/Debian:
sudo ufw allow 8108

# CentOS/RHEL:
sudo firewall-cmd --add-port=8108/tcp --permanent
sudo firewall-cmd --reload
```

### 步骤 7：修改前端配置

在前端 `vis/vite.config.js` 中，修改代理目标为服务器地址：

```javascript
server: {
  host: "127.0.0.1",
  port: 8080,
  proxy: {
    "/api": {
      target: "http://10.181.142.180:8108",  // 改为服务器地址
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, ""),
    },
  },
},
```

## 常见问题

### 1. SSH 连接被拒绝

- 检查 IP 和端口是否正确
- 确认服务器 SSH 服务正在运行
- 检查网络连接（是否在同一网络或 VPN）

### 2. 密码认证失败

- 确认用户名和密码正确
- 检查是否启用了密钥认证（可能需要配置 SSH 密钥）

### 3. 端口无法访问

- 检查服务器防火墙设置
- 确认后端服务正在运行：`ps aux | grep python`
- 检查后端监听的 IP（`0.0.0.0` 还是 `127.0.0.1`）

### 4. 数据库连接失败

- 确认服务器上 MySQL 已安装并运行
- 检查数据库用户权限
- 修改 `app.py` 中的数据库连接字符串

## 使用场景

这个服务器连接信息通常用于：

1. **远程开发**：在本地编辑代码，在服务器上运行（利用 GPU）
2. **生产部署**：将后端服务部署到服务器上，供团队使用
3. **GPU 计算**：服务器有 2080Ti GPU，可以运行需要 GPU 的模型训练或推理

## 安全建议

⚠️ **重要**：密码直接写在文档中不安全，建议：

1. 使用 SSH 密钥认证（更安全）
2. 如果必须使用密码，不要将包含密码的文件提交到 Git
3. 考虑使用环境变量或配置文件（不提交到版本控制）

### 配置 SSH 密钥（推荐）

```bash
# 在本地生成密钥对
ssh-keygen -t rsa -b 4096

# 将公钥复制到服务器
ssh-copy-id -p 1022 ls@10.181.142.180

# 之后就可以无密码登录了
ssh -p 1022 ls@10.181.142.180
```
